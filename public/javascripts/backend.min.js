function editAuthorIds(e){"edit"==e?($(".authorIds").css("display","none"),$(".authorIds_input").attr("style","display:display"),$("#author_ids_edit").attr("onclick","editAuthorIds('cancel')")):"cancel"==e&&($(".authorIds").attr("style","display:display"),$(".authorIds_input").attr("style","display:none"),$("#author_ids_edit").attr("onclick","editAuthorIds('edit')"))}function generate_link(e,t){var a="/requestcopy/"+t+"/"+e;$.post(a,{approved:1},function(t){var a=t.url;$("ul[id$='_rac_dd_"+e+"'] li input").val(a),$('ul[id$="_rac_dd_'+e+'"]').dropdown("toggle")},"json")}function linkPevz(e){var t="";t=$(e).attr("data-type");var a=$(e).attr("id").replace(t+"link_pevz_","");if("Not Authorized"==$("#"+t+"Authorized"+a).attr("alt")){var i="/librecat/search_researcher?ftext=",r="",s="",o=$("#"+t+"first_name_"+a).val();$("#"+t+"orig_first_name_"+a).val(o);var n=o.toLowerCase(),d=$("#"+t+"last_name_"+a).val();$("#"+t+"orig_last_name_"+a).val(d);var l=d.toLowerCase();n&&(n.indexOf(" ")>-1?(r+='firstname any "'+n+'"',s+='oldfirstname any "'+n+'"'):n.indexOf("-")>-1||n.indexOf("ä")>-1||n.indexOf("ö")>-1||n.indexOf("ü")>-1||n.indexOf("ß")>-1?(r+="firstname="+n,s+="oldfirstname="+n):(r+="firstname="+n+"*",s+="oldfirstname="+n+"*")),n&&l&&(r+=" AND ",s+=" AND "),l&&(l.indexOf(" ")>-1?(r+='lastname any "'+l+'"',s+='oldlastname any "'+l+'"'):l.indexOf("-")>-1||l.indexOf("ä")>-1||l.indexOf("ö")>-1||l.indexOf("ü")>-1||l.indexOf("ß")>-1?(r+="lastname="+l,s+="oldlastname="+l):(r+="lastname=*"+l+"*",s+="oldlastname=*"+l+"*")),""!=r&&""!=s?r=i+"("+r+") OR ("+s+")":""!=r&&""==s?r=i+r:""==r&&""!=s&&(r=i+s),$.get(r,function(e){if(1!=e.length||e[0].old_full_name&&e[0].full_name)if(e.length>1||1==e.length&&e[0].old_full_name&&e[0].full_name){var i=$("#"+t+"linkPevzModal").find(".modal-title").first();i.html("");var r="Several PEVZ Accounts found... make a choice",s=$("#"+t+"linkPevzModal").find(".modal-body").first();s.html("");for(var o='<p><strong>Exact hits:</strong></p><table class="table table-striped" id="lineId'+a+'"><tr><th>PEVZ-ID</th><th>Name</th></tr>',d="",c='<p><strong>Further hits:</strong></p><table class="table table-striped" id="lineId'+a+'"><tr><th>PEVZ-ID</th><th>Name</th></tr>',p="",m=0;m<e.length;m++){var _=e[m],h="",u="",f="",v="",b="",g="";$.each(_,function(e,t){"_id"==e&&(h=t),"orcid"==e&&(u=t),"first_name"==e&&(f=t,first_nameLc=t.toLowerCase()),"old_first_name"==e&&(v=t,old_first_nameLc=t.toLowerCase()),"last_name"==e&&(b=t,last_nameLc=t.toLowerCase()),"old_last_name"==e&&(g=t,old_last_nameLc=t.toLowerCase())}),n==f.toLowerCase()&&""==l||l==b.toLowerCase()&&""==n||l==b.toLowerCase()&&n==f.toLowerCase()||n==v.toLowerCase()&&""==l||l==g.toLowerCase()&&""==n||l==g.toLowerCase()&&n==v.toLowerCase()?(d+='<tr data-id="'+h+'" data-orcid="'+u+'"><td><a href="#" class="pevzLink">'+h+'</a></td><td class="name" data-firstname="'+f+'" data-lastname="'+b+'"><a href="#" class="pevzLink">'+f+" "+b+"</a></td></tr>",(v||g)&&(d+='<tr data-id="'+h+'"><td><a href="#" class="pevzLink">'+h+'</a></td><td class="name" data-firstname="'+v+'" data-lastname="'+g+'"><a href="#" class="pevzLink">'+v+" "+g+"</a> (now "+f+" "+b+")</td></tr>")):p+='<tr data-id="'+h+'"><td><a href="#" class="pevzLink">'+h+'</a></td><td class="name" data-firstname="'+f+'" data-lastname="'+b+'"><a href="#" class="pevzLink">'+f+" "+b+"</a></td></tr>"}""==d?o="<p><strong>Exact hits:</strong></p><p>There were no exact hits for <em>'"+n+" "+l+"'</em>.</p>":o+=d+"</table>",""==p?c="":c+=p+"</table>",i.append(r),s.append(o),s.append(c),$(".pevzLink").bind("click",function(){var e=$(this).parent().parent().attr("data-id"),a=$(this).parent().parent().attr("data-orcid"),i=$(this).parent().parent().find(".name").attr("data-firstname"),r=$(this).parent().parent().find(".name").attr("data-lastname"),s=$(this).parents(".table").attr("id").replace("lineId","");$("#"+t+"first_name_"+s).val(""),$("#"+t+"first_name_"+s).val(i),$("#"+t+"last_name_"+s).val(""),$("#"+t+"last_name_"+s).val(r),$("#"+t+"first_name_"+s+", #"+t+"last_name_"+s).attr("readonly","readonly"),$("#"+t+"Authorized"+s).attr("src","/images/biAuthorized.png"),$("#"+t+"Authorized"+s).attr("alt","Authorized"),$("#"+t+"first_name_"+s+", #"+t+"last_name_"+s).parent().removeClass("has-error"),$("#"+t+"id_"+s).val(e),$("#"+t+"orcid_"+s).val(a),$("#"+t+"linkPevzModal").modal("hide"),$("#"+t+"linkPevzModal").find(".modal-body").first().html("")}),$("#"+t+"linkPevzModal").modal("show")}else{var i=$("#"+t+"linkPevzModal").find(".modal-title").first(),r="Sorry...",s=$("#"+t+"linkPevzModal").find(".modal-body").first();s.html(""),i.html(""),s.append('<p class="has-error">No results found.</p>'),i.append(r),$("#"+t+"linkPevzModal").modal("show")}else{var _=e[0],h="",u="",f="",b="";$.each(_,function(e,t){"_id"==e&&(h=t),"first_name"==e&&(f=t),"last_name"==e&&(b=t),"orcid"==e&&(u=t)}),$("#"+t+"first_name_"+a).val(f),$("#"+t+"last_name_"+a).val(b),$("#"+t+"first_name_"+a+", #"+t+"last_name_"+a).attr("readonly","readonly"),$("#"+t+"Authorized"+a).attr("src","/images/biAuthorized.png"),$("#"+t+"Authorized"+a).attr("alt","Authorized"),$("#"+t+"first_name_"+a+", #"+t+"last_name_"+a).parent().removeClass("has-error"),$("#"+t+"id_"+a).val(h),$("#"+t+"orcid_"+a).val(u),h="",u="",f="",b=""}},"json")}else{var c="";c=$("#"+t+"orig_first_name_"+a).val();var p="";p=$("#"+t+"orig_last_name_"+a).val(),"Authorized"==$("#"+t+"Authorized"+a).attr("alt")&&($("#"+t+"Authorized"+a).attr("src","/images/biNotAuthorized.png"),$("#"+t+"Authorized"+a).attr("alt","Not Authorized"),$("#"+t+"id_"+a).val(""),$("#"+t+"first_name_"+a+", #"+t+"last_name_"+a).removeAttr("readonly")),$("#"+t+"first_name_"+a).val(c),$("#"+t+"orig_first_name_"+a).val(""),$("#"+t+"last_name_"+a).val(p),$("#"+t+"orig_last_name_"+a).val("")}}function edit_file(e,t){var a=jQuery.parseJSON($("#file_"+e).val());a.file_id&&$("#id_file_id").val(a.file_id),a.tempid&&$("#id_temp_id").val(a.tempid),$("#id_record_id").val(t),$("#id_fileName").val(a.file_name),$("#id_creator").val(a.creator),a.title&&$("#id_fileTitle").val(a.title),a.description&&$("#id_fileDescription").val(a.description),"main_file"!=a.relation?$('#id_select_relation option[value="'+a.relation+'"]').prop("selected",!0):$('#id_select_relation option[value="main_file"]').prop("selected",!0),"open_access"==a.access_level?($("#id_accessLevel_openAccess").prop("checked",!0),$("#id_accessEmbargo").prop("disabled",!0)):"local"==a.access_level?($("#id_accessLevel_unibi").prop("checked",!0),$("#id_accessEmbargo").prop("disabled",!1)):"closed"==a.access_level&&("1"==a.request_a_copy?$("#id_accessLevel_request").prop("checked",!0):$("#id_accessLevel_admin").prop("checked",!0),$("#id_accessEmbargo").prop("disabled",!1)),a.embargo&&""!=a.embargo&&($("#id_accessEmbargo").prop("checked",!0),$("#id_embargo").prop("disabled",!1),$("#id_embargo").val(a.embargo));var i=self.document.getElementById("fileNameTag");i.style.display="block",$("#upload_file").modal("show")}function delete_file(e){return confirm("Are you sure you want to delete this uploaded document? Any external links will be broken!\nIf you need to update an existing file to a new version you should edit the corresponding entry in the list and re-upload the file.\n\nDelete this file?")&&($("#"+e).remove(),$("#file_order_"+e).remove()),!1}function add_field(e,t){var a=$("#"+e+" div.row.innerrow"),i=a.index($("#"+e+" div.row.innerrow").last())+1,r=$(a[0]).clone();$(r).find("input, textarea, img, button, select, span").each(function(){if($(this).attr("id")){var e=$(this).attr("id").replace(/0/g,i);$(this).attr("id",e)}if($(this).attr("name")){var a=$(this).attr("name").replace(/0/g,i);$(this).attr("name",a)}$(this).attr("disabled",!1),$(this).attr("readonly",!1),$(this).removeClass("has-error"),$(this).removeAttr("autocomplete"),$(this).removeAttr("onfocus"),t&&$(this).attr("placeholder",t),"BUTTON"!=$(this).prop("tagName")&&$(this).val(""),"IMG"==$(this).prop("tagName")&&($(this).attr("src","/images/biNotAuthorized.png"),$(this).attr("alt","Not Authorized"),$(this).tooltip())}),$(r).find("#revert_"+i).tooltip(),$("#"+e).append(r);switch(e){case"department":enable_autocomplete("dp",i);break;case"affiliation":enable_autocomplete("aff",i);break;case"data_manager":enable_autocomplete("dm",i);break;case"reviewer":enable_autocomplete("rv",i);break;case"person_affiliation":enable_autocomplete("person_aff",i);break;case"project":enable_autocomplete("pj",i)}}function remove_field(e){var t=$(e).closest("div.row.innerrow"),a=$(t).index();parseInt(a)>0?$(t).remove():0==parseInt(a)&&$(t).find("input, textarea, img, select").each(function(){$(this).val(""),$(this).attr("disabled",!1),$(this).attr("readonly",!1),$(this).removeAttr("autocomplete"),"IMG"==$(this).prop("tagName")&&($(this).attr("src","/images/biNotAuthorized.png"),$(this).attr("alt","Not Authorized"))})}function enable_autocomplete(e,t){var a;switch(e){case"pj":a="project";break;case"person_aff":a="department";break;default:a="department"}$("#"+e+"_autocomplete_"+t).autocomplete({source:"/librecat/autocomplete_hierarchy?fmt=autocomplete&type="+a,minLength:2,messages:{noResults:"",results:function(){}},select:function(a,i){$("#"+e+"_autocomplete_"+t).val(i.item.label),$("#"+e+"_nameautocomplete_"+t).val(i.item.label),$("#"+e+"_idautocomplete_"+t).val(i.item.id),$("#"+e+"_autocomplete_"+t).attr("disabled","disabled"),$("input.sticky").blur()},close:function(){$("input.sticky").blur(),"person_aff"==e&&$("#id_save_aff").submit()}})}$(function(){$(".check_alias").keyup(function(){var e=$(this),t=e.val(),a=$(e).data("id");$.ajax({url:"/librecat/autocomplete_alias/"+a+"/"+t,dataType:"json",success:function(t){0==t.ok?e.closest(".form-group").addClass("has-error"):e.closest(".form-group").removeClass("has-error")}})})}),$(function(){$(".change_mode").click(function(){$("#edit_mode").val("normal"==$("#edit_mode").val()?"expert":"normal"),$("#edit_form").attr("action","/librecat/record/change_mode"),$("#edit_form").submit()}),$(".change_type").click(function(){var e=confirm("Changing the type of a record may result in loss of data if the new type uses different fields than the old one! Proceed with caution");if(e){var t=$(this).data("val");$("#id_type").val(t),$("#id_select_type").remove(),$("#edit_form").attr("action","/librecat/record/change_mode"),$("#edit_form").submit()}})}),$(function(){$(".dropzone").sortable({containerSelector:"div.dz-preview",itemSelector:"div.dz-preview",update:function(e,t){var a=t.item.attr("id");if($('#sortFilesInput input[value="'+a+'"]').remove(),1==t.item.index())$("#sortFilesInput").prepend('<input type="hidden" name="file_order" id="file_order_'+a+'" value="'+a+'"/>');else{var i=t.item.index()-1;$("#sortFilesInput input:nth-child("+i+")").after('<input type="hidden" name="file_order" id="file_order_'+a+'" value="'+a+'"/>')}t.item.removeClass("dragged").removeAttr("style"),$("body").removeClass("dragging")}}),$(".creator").sortable({containerSelector:"div.row.innerrow",itemSelector:"div.sortitem",update:function(e,t){$(".creator").find("div.row.innerrow").each(function(e){var t=$(this);t.find("input[name]").each(function(){var t=/(.*\.)\d{1,}(\..*)/g,a=$(this).attr("name"),i=t.exec(a);$(this).attr("name",i[1]+e+i[2])})}),t.item.removeClass("dragged").removeAttr("style"),$("body").removeClass("dragging")}})}),$(function(){$("div.input-group.sticky .input-group-addon:first-child").on("click",function(){$(this).parent("div.input-group.sticky").children("input, select").focus()}),$("input.sticky, select.sticky, textarea.sticky").on("focus",function(){var e=$(this).parent("div.sticky"),t=e.children("div.input-group-addon:first-child");(e.parent(".form-group").hasClass("hidden-lg")||e.parent(".form-group").hasClass("hidden-md"))&&t&&"SELECT"!=$(this).prop("tagName")&&(t.css("display","none"),$(this).css("border-bottom-left-radius","3px"),$(this).css("border-top-left-radius","3px")),$(this).css("border","none");$(this).parent("div.input-group.sticky").children("div.input-group-addon");if($(this).parent("div.sticky").hasClass("mandatory")?($(this).parent("div.sticky").css("-webkit-box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #d3d3d3"),$(this).parent("div.sticky").css("box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #d3d3d3"),$(this).parent("div.sticky").css("border","1px solid #666"),$(this).css("box-shadow","inset 0 1px 1px -1px rgba(0, 0, 0, 0.075), 0 0 6px -6px #d3d3d3")):($(this).parent("div.sticky").css("-webkit-box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6)"),$(this).parent("div.sticky").css("box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6)"),$(this).parent("div.sticky").css("border","1px solid #66afe9"),$(this).css("box-shadow","inset 0 1px 1px -1px rgba(0, 0, 0, 0.075), 0 0 8px -8px rgba(102, 175, 233, 0.6)")),$(this).attr("id")){var a=$(this).attr("id").match(/dp_autocomplete_(\d{1,})/);if(a&&a[1]){var i=a[1];enable_autocomplete("dp",i)}if(a=$(this).attr("id").match(/pj_autocomplete_(\d{1,})/),a&&a[1]){var i=a[1];enable_autocomplete("pj",i)}}}),$("input.sticky, select.sticky, textarea.sticky").on("blur",function(){var e=$(this).parent("div.input-group.sticky").children("div.input-group-addon");e.css("border","none"),$(this).parent("div.sticky").hasClass("mandatory")?$(this).parent("div.sticky").css("border","1px solid #666"):$(this).parent("div.sticky").css("border","1px solid #cccccc"),$(this).parent("div.sticky").css("-webkit-box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075)"),$(this).parent("div.sticky").css("box-shadow","inset 0 1px 1px rgba(0, 0, 0, 0.075)"),$(this).parent("div.sticky").css("-webkit-box-shadow","none"),$(this).parent("div.sticky").css("box-shadow","none"),$(this).parent("div.sticky").css("border-radius","3px");var t=$(this).parent("div.input-group.sticky").children("div.input-group-addon:first-child");t.css("display","table-cell")})});
